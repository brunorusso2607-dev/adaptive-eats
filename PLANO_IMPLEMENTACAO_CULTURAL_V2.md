# ğŸŒ PLANO DE IMPLEMENTAÃ‡ÃƒO V2 - POOL DE REFEIÃ‡Ã•ES COM RIGOR CULTURAL

## ğŸ¯ OBJETIVO REVISADO

Criar um sistema de geraÃ§Ã£o de refeiÃ§Ãµes que **respeite rigorosamente os hÃ¡bitos alimentares culturais** de cada paÃ­s, evitando combinaÃ§Ãµes sem nexo (como arroz com cafÃ©, suco com ovo, etc.) e garantindo que cada refeiÃ§Ã£o seja **autÃªntica e natural** para o estilo de vida local.

---

## ğŸ” ANÃLISE PROFUNDA - HÃBITOS ALIMENTARES POR PAÃS

### ğŸ‡§ğŸ‡· **BRASIL**

#### **CafÃ© da ManhÃ£ (6h-9h)**
**Estrutura tÃ­pica:** PÃ£o/Tapioca + Bebida quente + Fruta
```
âœ… CORRETO:
- PÃ£o francÃªs com manteiga + CafÃ© com leite + MamÃ£o
- Tapioca com queijo + CafÃ© puro + Banana
- Ovos mexidos + PÃ£o integral + Suco de laranja

âŒ ERRADO (sem nexo cultural):
- Arroz + FeijÃ£o + CafÃ© (isso Ã© almoÃ§o, nÃ£o cafÃ©)
- Frango grelhado + Salada + CafÃ© (isso Ã© jantar)
- MacarrÃ£o + Suco (nÃ£o Ã© cafÃ© da manhÃ£ brasileiro)
```

**Bebidas tÃ­picas:** CafÃ© (com ou sem leite), suco natural, Ã¡gua de coco
**Proibido no cafÃ©:** Refrigerante, arroz, feijÃ£o, massas, carnes pesadas

#### **AlmoÃ§o (12h-14h)**
**Estrutura OBRIGATÃ“RIA:** Arroz + FeijÃ£o + ProteÃ­na + Salada/Legumes
```
âœ… CORRETO:
- Arroz branco + FeijÃ£o carioca + Frango grelhado + Salada verde
- Arroz integral + FeijÃ£o preto + Bife + Legumes refogados
- Arroz + FeijÃ£o + Peixe grelhado + BrÃ³colis

âŒ ERRADO:
- SÃ³ proteÃ­na + salada (isso Ã© jantar, nÃ£o almoÃ§o)
- PÃ£o + Ovo + CafÃ© (isso Ã© cafÃ© da manhÃ£)
- MacarrÃ£o + Arroz (carboidrato duplicado, nÃ£o Ã© comum)
```

**Regra cultural:** Brasileiro come arroz + feijÃ£o no almoÃ§o. Ã‰ a base da refeiÃ§Ã£o.

#### **Jantar (19h-21h)**
**Estrutura tÃ­pica:** Mais leve que almoÃ§o OU similar ao almoÃ§o
```
âœ… CORRETO:
- Frango grelhado + Salada verde (leve)
- Omelete + Legumes refogados (leve)
- Sopa de legumes com frango (prato Ãºnico)
- OU: Arroz + FeijÃ£o + ProteÃ­na + Salada (igual almoÃ§o)

âŒ ERRADO:
- PÃ£o + CafÃ© + Fruta (isso Ã© cafÃ© da manhÃ£)
- SÃ³ iogurte + granola (isso Ã© lanche)
```

---

### ğŸ‡ºğŸ‡¸ **ESTADOS UNIDOS**

#### **Breakfast (7h-9h)**
**Estrutura tÃ­pica:** Protein + Bread/Grain + Fruit/Beverage
```
âœ… CORRETO:
- Scrambled eggs + Whole wheat toast + Orange juice
- Oatmeal + Banana + Coffee
- Greek yogurt + Granola + Berries

âŒ ERRADO:
- Rice + Beans (isso Ã© lunch/dinner)
- Grilled chicken + Salad (isso Ã© lunch/dinner)
- Pasta + Tomato sauce (nÃ£o Ã© breakfast)
```

**Bebidas tÃ­picas:** Coffee, orange juice, milk, smoothies
**Proibido no breakfast:** Rice, beans, heavy meats, pasta

#### **Lunch (12h-13h)**
**Estrutura tÃ­pica:** Sandwich/Salad/Wrap + Side
```
âœ… CORRETO:
- Turkey sandwich + Apple slices
- Caesar salad with grilled chicken
- Chicken wrap + Carrot sticks

âŒ ERRADO:
- Eggs + Toast + Coffee (isso Ã© breakfast)
- Rice + Beans + Chicken (nÃ£o Ã© tÃ­pico americano)
```

#### **Dinner (18h-20h)**
**Estrutura tÃ­pica:** Protein + Starch + Vegetable
```
âœ… CORRETO:
- Grilled salmon + Roasted sweet potato + Steamed broccoli
- Chicken breast + Mashed potatoes + Green beans
- Steak + Baked potato + Asparagus

âŒ ERRADO:
- Eggs + Toast (isso Ã© breakfast)
- Sandwich + Chips (isso Ã© lunch)
```

---

### ğŸ‡µğŸ‡¹ **PORTUGAL**

#### **Pequeno-almoÃ§o (7h-9h)**
**Estrutura tÃ­pica:** PÃ£o/Torrada + Bebida quente + Fruta/Sumo
```
âœ… CORRETO:
- Torrada com manteiga + CafÃ© com leite + Sumo de laranja
- PÃ£o com queijo + CafÃ© + Fruta fresca
- Cereais com leite + CafÃ©

âŒ ERRADO:
- Arroz + Peixe (isso Ã© almoÃ§o)
- Batatas + Carne (isso Ã© almoÃ§o/jantar)
```

#### **AlmoÃ§o (12h-14h)**
**Estrutura tÃ­pica:** Sopa + Prato principal (ProteÃ­na + Arroz/Batata + Legumes)
```
âœ… CORRETO:
- Caldo verde + Bacalhau com batatas e legumes
- Sopa de legumes + Frango assado com arroz e brÃ³colos
- Sopa + Peixe grelhado com batatas

âŒ ERRADO:
- SÃ³ sopa (incompleto, falta prato principal)
- PÃ£o + CafÃ© (isso Ã© pequeno-almoÃ§o)
```

**Regra cultural:** PortuguÃªs come sopa ANTES do prato principal no almoÃ§o.

---

### ğŸ‡²ğŸ‡½ **MÃ‰XICO**

#### **Desayuno (7h-10h)**
**Estrutura tÃ­pica:** Huevos + Frijoles/Tortilla + Fruta + Bebida
```
âœ… CORRETO:
- Huevos rancheros + Frijoles refritos + Tortilla + CafÃ©
- Chilaquiles verdes + Frijoles + Jugo de naranja
- Huevos revueltos + Tortilla + Papaya

âŒ ERRADO:
- Arroz + Pollo (isso Ã© comida/cena)
- Pan dulce + CafÃ© APENAS (incompleto, falta proteÃ­na)
```

**Regra cultural:** Mexicano come ovos + feijÃ£o no cafÃ© da manhÃ£. Tortilla Ã© essencial.

#### **Comida (14h-16h) - RefeiÃ§Ã£o principal**
**Estrutura tÃ­pica:** ProteÃ­na + Arroz/Frijoles + Tortilla + Ensalada
```
âœ… CORRETO:
- Pollo a la plancha + Arroz rojo + Frijoles + Tortilla + Ensalada
- Carne asada + Frijoles + Tortilla + Guacamole
- Pescado + Arroz + Ensalada de nopales

âŒ ERRADO:
- Huevos + Frijoles (isso Ã© desayuno)
- Solo ensalada (incompleto)
```

---

## âŒ COMBINAÃ‡Ã•ES CULTURALMENTE INVÃLIDAS (NUNCA GERAR)

### **CombinaÃ§Ãµes Absurdas Universais**
```
âŒ Arroz + CafÃ© (carboidrato pesado com bebida de cafÃ© da manhÃ£)
âŒ FeijÃ£o + Suco (feijÃ£o nÃ£o combina com suco doce)
âŒ MacarrÃ£o + PÃ£o (dois carboidratos pesados juntos)
âŒ Carne + Iogurte (proteÃ­na pesada com lÃ¡cteo)
âŒ Peixe + Leite (combinaÃ§Ã£o culturalmente estranha)
âŒ Ovo frito + Refrigerante (nÃ£o Ã© refeiÃ§Ã£o saudÃ¡vel)
```

### **Erros por Tipo de RefeiÃ§Ã£o**
```
âŒ CAFÃ‰ DA MANHÃƒ com arroz, feijÃ£o, macarrÃ£o, carnes pesadas
âŒ ALMOÃ‡O com pÃ£o + cafÃ© (isso Ã© cafÃ© da manhÃ£)
âŒ JANTAR com cereais + leite (isso Ã© cafÃ© da manhÃ£)
âŒ LANCHE com arroz + feijÃ£o (isso Ã© almoÃ§o)
```

### **Erros Culturais por PaÃ­s**

**Brasil:**
```
âŒ AlmoÃ§o SEM arroz + feijÃ£o (nÃ£o Ã© almoÃ§o brasileiro tÃ­pico)
âŒ CafÃ© da manhÃ£ com arroz (nÃ£o Ã© cultural)
âŒ Jantar com tapioca + cafÃ© (isso Ã© cafÃ© da manhÃ£)
```

**EUA:**
```
âŒ Breakfast com rice + beans (nÃ£o Ã© cultural)
âŒ Lunch com eggs + toast (isso Ã© breakfast)
âŒ Dinner com cereal + milk (isso Ã© breakfast)
```

**Portugal:**
```
âŒ AlmoÃ§o SEM sopa (nÃ£o Ã© completo culturalmente)
âŒ Pequeno-almoÃ§o com bacalhau (nÃ£o Ã© cultural)
```

**MÃ©xico:**
```
âŒ Desayuno SEM huevos ou tortilla (incompleto)
âŒ Comida SEM tortilla (nÃ£o Ã© cultural)
```

---

## ğŸ›¡ï¸ SISTEMA DE VALIDAÃ‡ÃƒO CULTURAL RIGOROSA

### **NÃ­vel 1: ValidaÃ§Ã£o de Estrutura ObrigatÃ³ria**

```typescript
interface MealStructureRule {
  mealType: string;
  country: string;
  required: string[];      // Componentes OBRIGATÃ“RIOS
  forbidden: string[];     // Componentes PROIBIDOS
  typical_beverages: string[];
  forbidden_beverages: string[];
}

const CULTURAL_RULES: MealStructureRule[] = [
  // BRASIL - CafÃ© da manhÃ£
  {
    mealType: "cafe_manha",
    country: "BR",
    required: ["carbs", "beverage"],  // PÃ£o/tapioca + bebida
    forbidden: ["legumes", "rice"],   // SEM arroz, feijÃ£o
    typical_beverages: ["cafÃ©", "cafÃ© com leite", "suco natural"],
    forbidden_beverages: ["refrigerante", "cerveja"]
  },
  
  // BRASIL - AlmoÃ§o
  {
    mealType: "almoco",
    country: "BR",
    required: ["carbs", "legumes", "proteins", "vegetables"],  // Arroz + FeijÃ£o + ProteÃ­na + Salada
    forbidden: ["bread", "toast"],  // SEM pÃ£o (isso Ã© cafÃ©)
    typical_beverages: ["Ã¡gua", "suco natural"],
    forbidden_beverages: ["cafÃ©", "leite"]  // CafÃ© nÃ£o Ã© comum no almoÃ§o
  },
  
  // USA - Breakfast
  {
    mealType: "cafe_manha",
    country: "US",
    required: ["proteins"],  // Ovos ou proteÃ­na
    forbidden: ["rice", "beans", "pasta"],  // SEM arroz, feijÃ£o, massa
    typical_beverages: ["coffee", "orange juice", "milk"],
    forbidden_beverages: ["soda"]
  },
  
  // ... definir para TODOS os tipos de refeiÃ§Ã£o de TODOS os paÃ­ses
];
```

### **NÃ­vel 2: ValidaÃ§Ã£o de CombinaÃ§Ãµes Proibidas**

```typescript
interface ForbiddenCombination {
  items: string[];
  reason: string;
  applies_to: string[];  // PaÃ­ses onde se aplica
}

const FORBIDDEN_COMBINATIONS: ForbiddenCombination[] = [
  {
    items: ["arroz", "cafÃ©"],
    reason: "Arroz nÃ£o combina com cafÃ© (refeiÃ§Ãµes diferentes)",
    applies_to: ["BR", "PT", "MX", "ALL"]
  },
  {
    items: ["feijÃ£o", "suco doce"],
    reason: "FeijÃ£o nÃ£o combina com suco doce",
    applies_to: ["BR", "MX", "ALL"]
  },
  {
    items: ["macarrÃ£o", "pÃ£o"],
    reason: "Dois carboidratos pesados juntos",
    applies_to: ["ALL"]
  },
  {
    items: ["peixe", "leite"],
    reason: "CombinaÃ§Ã£o culturalmente estranha",
    applies_to: ["ALL"]
  },
  {
    items: ["carne pesada", "iogurte"],
    reason: "ProteÃ­na pesada com lÃ¡cteo nÃ£o combina",
    applies_to: ["ALL"]
  },
  // ... adicionar TODAS as combinaÃ§Ãµes absurdas
];
```

### **NÃ­vel 3: ValidaÃ§Ã£o de Bebidas por RefeiÃ§Ã£o**

```typescript
interface BeverageRule {
  mealType: string;
  country: string;
  allowed: string[];
  forbidden: string[];
}

const BEVERAGE_RULES: BeverageRule[] = [
  {
    mealType: "cafe_manha",
    country: "BR",
    allowed: ["cafÃ©", "cafÃ© com leite", "suco natural", "Ã¡gua de coco", "chÃ¡"],
    forbidden: ["refrigerante", "cerveja", "vinho"]
  },
  {
    mealType: "almoco",
    country: "BR",
    allowed: ["Ã¡gua", "suco natural", "Ã¡gua de coco"],
    forbidden: ["cafÃ©", "leite", "refrigerante"]  // CafÃ© no almoÃ§o nÃ£o Ã© comum
  },
  // ... definir para TODOS
];
```

### **NÃ­vel 4: ValidaÃ§Ã£o SemÃ¢ntica com IA**

```typescript
// ADICIONAR AO PROMPT - Exemplos NEGATIVOS por paÃ­s e tipo

function buildNegativeExamples(mealType: string, country: string): string {
  const negatives: Record<string, Record<string, string[]>> = {
    BR: {
      cafe_manha: [
        "âŒ Arroz branco + FeijÃ£o carioca + Frango + CafÃ© (ISSO Ã‰ ALMOÃ‡O, NÃƒO CAFÃ‰ DA MANHÃƒ)",
        "âŒ MacarrÃ£o com molho + Suco (NÃƒO Ã‰ CAFÃ‰ DA MANHÃƒ BRASILEIRO)",
        "âŒ Bife grelhado + Salada + CafÃ© (ISSO Ã‰ JANTAR, NÃƒO CAFÃ‰)",
        "âŒ SÃ³ cafÃ© + biscoito (INCOMPLETO, falta proteÃ­na e fruta)"
      ],
      almoco: [
        "âŒ PÃ£o francÃªs + Ovo + CafÃ© (ISSO Ã‰ CAFÃ‰ DA MANHÃƒ, NÃƒO ALMOÃ‡O)",
        "âŒ SÃ³ frango + salada (FALTA ARROZ + FEIJÃƒO - nÃ£o Ã© almoÃ§o brasileiro tÃ­pico)",
        "âŒ Tapioca + queijo + cafÃ© (ISSO Ã‰ CAFÃ‰ DA MANHÃƒ)",
        "âŒ MacarrÃ£o + Arroz (DOIS CARBOIDRATOS PESADOS, nÃ£o Ã© comum)"
      ],
      jantar: [
        "âŒ PÃ£o + CafÃ© + Fruta (ISSO Ã‰ CAFÃ‰ DA MANHÃƒ)",
        "âŒ Cereal + Leite (ISSO Ã‰ CAFÃ‰ DA MANHÃƒ)",
        "âŒ SÃ³ iogurte + granola (ISSO Ã‰ LANCHE, muito leve para jantar)"
      ]
    },
    US: {
      cafe_manha: [
        "âŒ Rice + Beans + Chicken (THIS IS LUNCH/DINNER, NOT BREAKFAST)",
        "âŒ Grilled steak + Salad (THIS IS DINNER, NOT BREAKFAST)",
        "âŒ Pasta with tomato sauce (NOT BREAKFAST)",
        "âŒ Just coffee + donut (INCOMPLETE, needs protein)"
      ],
      almoco: [
        "âŒ Eggs + Toast + Coffee (THIS IS BREAKFAST, NOT LUNCH)",
        "âŒ Cereal + Milk (THIS IS BREAKFAST)",
        "âŒ Pancakes + Syrup (THIS IS BREAKFAST)"
      ]
    },
    // ... para TODOS os paÃ­ses
  };
  
  return negatives[country]?.[mealType]?.join('\n') || '';
}
```

---

## ğŸ—ï¸ ARQUITETURA DE IMPLEMENTAÃ‡ÃƒO

### **Camada 1: Componentes Culturalmente Corretos**

```typescript
// NOVO: Componentes organizados POR PAÃS e POR TIPO DE REFEIÃ‡ÃƒO
const CULTURAL_MEAL_COMPONENTS = {
  BR: {
    cafe_manha: {
      carbs: [
        { name: "PÃ£o francÃªs", portion_grams: 50 },
        { name: "PÃ£o integral", portion_grams: 50 },
        { name: "Tapioca", portion_grams: 50 },
        { name: "Cuscuz", portion_grams: 100 },
        // SEM: arroz, macarrÃ£o, feijÃ£o
      ],
      proteins: [
        { name: "Ovo mexido", portion_grams: 100 },
        { name: "Ovo frito", portion_grams: 50 },
        { name: "Queijo branco", portion_grams: 30 },
        { name: "RequeijÃ£o", portion_grams: 30 },
        // SEM: frango, carne, peixe (muito pesado para cafÃ©)
      ],
      beverages: [
        { name: "CafÃ© puro", portion_ml: 100 },
        { name: "CafÃ© com leite", portion_ml: 200 },
        { name: "Suco de laranja", portion_ml: 200 },
        { name: "Ãgua de coco", portion_ml: 200 },
        // SEM: refrigerante, cerveja
      ],
      fruits: [
        { name: "Banana", portion_grams: 100 },
        { name: "MamÃ£o", portion_grams: 150 },
        { name: "Melancia", portion_grams: 200 },
      ]
    },
    
    almoco: {
      carbs: [
        { name: "Arroz branco", portion_grams: 100 },
        { name: "Arroz integral", portion_grams: 100 },
        // SEM: pÃ£o, tapioca (isso Ã© cafÃ© da manhÃ£)
      ],
      legumes: [
        { name: "FeijÃ£o carioca", portion_grams: 80 },
        { name: "FeijÃ£o preto", portion_grams: 80 },
        // OBRIGATÃ“RIO no almoÃ§o brasileiro
      ],
      proteins: [
        { name: "Frango grelhado", portion_grams: 120 },
        { name: "Bife grelhado", portion_grams: 100 },
        { name: "Peixe grelhado", portion_grams: 120 },
      ],
      vegetables: [
        { name: "Salada verde", portion_grams: 80 },
        { name: "Legumes refogados", portion_grams: 100 },
        { name: "BrÃ³colis", portion_grams: 80 },
      ],
      beverages: [
        { name: "Ãgua", portion_ml: 200 },
        { name: "Suco natural", portion_ml: 200 },
        // SEM: cafÃ©, leite (nÃ£o Ã© comum no almoÃ§o)
      ]
    },
    
    // ... jantar, lanches
  },
  
  US: {
    cafe_manha: {
      proteins: [
        { name: "Scrambled eggs", portion_grams: 100 },
        { name: "Greek yogurt", portion_grams: 170 },
        { name: "Turkey bacon", portion_grams: 30 },
        // SEM: heavy meats (steak, chicken breast)
      ],
      carbs: [
        { name: "Whole wheat toast", portion_grams: 35 },
        { name: "Oatmeal", portion_grams: 40 },
        { name: "Pancakes", portion_grams: 80 },
        // SEM: rice, pasta, beans
      ],
      // ...
    },
    // ...
  },
  
  // ... PT, MX, ES, AR, CO
};
```

### **Camada 2: FunÃ§Ã£o de ValidaÃ§Ã£o Cultural**

```typescript
function validateCulturalMeal(
  meal: GeneratedMeal,
  mealType: string,
  country: string
): { valid: boolean; errors: string[] } {
  const errors: string[] = [];
  
  // 1. Validar estrutura obrigatÃ³ria
  const rule = CULTURAL_RULES.find(r => 
    r.mealType === mealType && r.country === country
  );
  
  if (rule) {
    // Verificar componentes obrigatÃ³rios
    for (const required of rule.required) {
      const hasRequired = meal.components.some(c => c.type === required);
      if (!hasRequired) {
        errors.push(`Falta componente obrigatÃ³rio para ${mealType} em ${country}: ${required}`);
      }
    }
    
    // Verificar componentes proibidos
    for (const forbidden of rule.forbidden) {
      const hasForbidden = meal.components.some(c => c.type === forbidden);
      if (hasForbidden) {
        errors.push(`Componente proibido para ${mealType} em ${country}: ${forbidden}`);
      }
    }
    
    // Verificar bebidas
    const beverages = meal.components.filter(c => c.type === 'beverage');
    for (const bev of beverages) {
      if (rule.forbidden_beverages.some(fb => 
        normalizeText(bev.name).includes(normalizeText(fb))
      )) {
        errors.push(`Bebida proibida para ${mealType} em ${country}: ${bev.name}`);
      }
    }
  }
  
  // 2. Validar combinaÃ§Ãµes proibidas
  for (const combo of FORBIDDEN_COMBINATIONS) {
    if (combo.applies_to.includes(country) || combo.applies_to.includes('ALL')) {
      const hasAllItems = combo.items.every(item =>
        meal.components.some(c => 
          normalizeText(c.name).includes(normalizeText(item))
        )
      );
      if (hasAllItems) {
        errors.push(`CombinaÃ§Ã£o proibida: ${combo.items.join(' + ')} - ${combo.reason}`);
      }
    }
  }
  
  // 3. ValidaÃ§Ã£o especÃ­fica por paÃ­s
  if (country === 'BR' && mealType === 'almoco') {
    // AlmoÃ§o brasileiro DEVE ter arroz + feijÃ£o
    const hasRice = meal.components.some(c => 
      normalizeText(c.name).includes('arroz')
    );
    const hasBeans = meal.components.some(c => 
      normalizeText(c.name).includes('feijao') || 
      normalizeText(c.name).includes('feijÃ£o')
    );
    if (!hasRice || !hasBeans) {
      errors.push('AlmoÃ§o brasileiro tÃ­pico deve ter arroz + feijÃ£o');
    }
  }
  
  if (country === 'PT' && mealType === 'almoco') {
    // AlmoÃ§o portuguÃªs DEVE ter sopa
    const hasSoup = meal.components.some(c => 
      normalizeText(c.name).includes('sopa') || 
      normalizeText(c.name).includes('caldo')
    );
    if (!hasSoup) {
      errors.push('AlmoÃ§o portuguÃªs tÃ­pico deve ter sopa');
    }
  }
  
  return { valid: errors.length === 0, errors };
}
```

### **Camada 3: Prompt Ultra-Rigoroso com Contexto Cultural**

```typescript
function buildCulturalPrompt(
  mealType: string,
  country: string,
  quantity: number
): string {
  const config = getRegionalConfig(country);
  const structure = config.mealStructure;
  const culturalRule = CULTURAL_RULES.find(r => 
    r.mealType === mealType && r.country === country
  );
  
  return `
ğŸŒ VOCÃŠ Ã‰ UM NUTRICIONISTA ${config.languageName.toUpperCase()} ESPECIALIZADO EM HÃBITOS ALIMENTARES LOCAIS

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ REGRA ABSOLUTA - RESPEITAR CULTURA ALIMENTAR
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PAÃS: ${country}
TIPO DE REFEIÃ‡ÃƒO: ${mealType}
IDIOMA: ${config.language}

ğŸ“‹ ESTRUTURA CULTURAL OBRIGATÃ“RIA:
${structure?.[mealType]?.structure || 'NÃ£o definida'}

âœ… COMPONENTES OBRIGATÃ“RIOS:
${culturalRule?.required.map(r => `- ${r} (OBRIGATÃ“RIO)`).join('\n')}

âŒ COMPONENTES PROIBIDOS (NUNCA USAR):
${culturalRule?.forbidden.map(f => `- ${f} (PROIBIDO - nÃ£o Ã© cultural)`).join('\n')}

ğŸ¥¤ BEBIDAS PERMITIDAS:
${culturalRule?.typical_beverages.map(b => `- ${b}`).join('\n')}

ğŸš« BEBIDAS PROIBIDAS:
${culturalRule?.forbidden_beverages.map(b => `- ${b} (NÃƒO usar)`).join('\n')}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… EXEMPLOS CORRETOS PARA ${mealType.toUpperCase()} EM ${country}:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${structure?.[mealType]?.examples?.map((e, i) => `${i + 1}. ${e}`).join('\n')}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âŒ EXEMPLOS INCORRETOS (NUNCA FAÃ‡A ISSO):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${buildNegativeExamples(mealType, country)}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ CHECKLIST CULTURAL ANTES DE RETORNAR:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ ] Todos os componentes sÃ£o tÃ­picos de ${mealType} em ${country}?
[ ] Tem TODOS os componentes obrigatÃ³rios?
[ ] NÃƒO tem nenhum componente proibido?
[ ] As bebidas sÃ£o apropriadas para ${mealType}?
[ ] A combinaÃ§Ã£o faz sentido culturalmente?
[ ] NÃ£o hÃ¡ combinaÃ§Ãµes absurdas (arroz+cafÃ©, feijÃ£o+suco doce)?
[ ] Um ${config.languageName} reconheceria isso como ${mealType} tÃ­pico?

SE QUALQUER RESPOSTA FOR NÃƒO, REFAÃ‡A A REFEIÃ‡ÃƒO COMPLETAMENTE.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ VALIDAÃ‡ÃƒO FINAL RIGOROSA:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Antes de retornar, VALIDE:
1. Isso Ã© REALMENTE um ${mealType} tÃ­pico de ${country}?
2. Uma pessoa de ${country} comeria isso no ${mealType}?
3. NÃ£o hÃ¡ nenhum ingrediente ou combinaÃ§Ã£o estranha?

SE VOCÃŠ TIVER QUALQUER DÃšVIDA, NÃƒO GERE A REFEIÃ‡ÃƒO.

Gere ${quantity} refeiÃ§Ãµes AUTÃŠNTICAS e CULTURALMENTE CORRETAS agora.
`;
}
```

---

## ğŸ“Š PLANO DE IMPLEMENTAÃ‡ÃƒO REVISADO

### **FASE 1: Estrutura Cultural (3-4h)**

**1.1. Criar CULTURAL_RULES completo**
- Definir regras para TODOS os tipos de refeiÃ§Ã£o
- Definir para TODOS os paÃ­ses (BR, US, PT, MX, ES, AR, CO)
- Incluir required, forbidden, beverages

**1.2. Criar FORBIDDEN_COMBINATIONS completo**
- Listar TODAS as combinaÃ§Ãµes absurdas
- Especificar para quais paÃ­ses se aplica
- Adicionar razÃµes claras

**1.3. Criar CULTURAL_MEAL_COMPONENTS**
- Organizar componentes POR PAÃS e POR TIPO
- Remover componentes inadequados de cada tipo
- Adicionar alternativas culturais

**1.4. Criar BEVERAGE_RULES**
- Definir bebidas permitidas/proibidas por refeiÃ§Ã£o
- Por paÃ­s e por tipo

---

### **FASE 2: ValidaÃ§Ã£o Rigorosa (2-3h)**

**2.1. Implementar validateCulturalMeal()**
- ValidaÃ§Ã£o de estrutura obrigatÃ³ria
- ValidaÃ§Ã£o de componentes proibidos
- ValidaÃ§Ã£o de combinaÃ§Ãµes absurdas
- ValidaÃ§Ã£o de bebidas
- ValidaÃ§Ã£o especÃ­fica por paÃ­s

**2.2. Implementar buildNegativeExamples()**
- Criar exemplos negativos para cada paÃ­s
- Para cada tipo de refeiÃ§Ã£o
- Com explicaÃ§Ãµes claras

**2.3. Integrar validaÃ§Ã£o no fluxo**
- Aplicar ANTES de inserir no banco
- Rejeitar refeiÃ§Ãµes invÃ¡lidas
- Logar motivos de rejeiÃ§Ã£o

---

### **FASE 3: Prompt Cultural Ultra-Rigoroso (2h)**

**3.1. Atualizar buildMealPoolPrompt()**
- Incluir contexto cultural completo
- Adicionar exemplos negativos
- Adicionar checklist de validaÃ§Ã£o
- ReforÃ§ar regras culturais

**3.2. Reduzir temperatura**
- De 0.7 para 0.2
- Adicionar topP: 0.8, topK: 20
- Mais determinÃ­stico

**3.3. Adicionar penalizaÃ§Ãµes**
- Instruir IA a NÃƒO gerar se tiver dÃºvida
- ReforÃ§ar que erros culturais sÃ£o inaceitÃ¡veis

---

### **FASE 4: Componentes com Alternativas (2h)**

**4.1. Expandir componentes**
- Adicionar versÃµes sem lactose
- Adicionar versÃµes sem glÃºten
- Manter culturalmente apropriado

**4.2. Modificar filtro**
- Incluir alternativas ao invÃ©s de remover
- Manter diversidade nutricional

---

### **FASE 5: Testes Culturais Rigorosos (2-3h)**

**5.1. Gerar 20 refeiÃ§Ãµes de cada tipo**
- Para cada paÃ­s
- Validar manualmente TODAS

**5.2. Checklist de validaÃ§Ã£o manual**
- [ ] Faz sentido culturalmente?
- [ ] Um nativo reconheceria?
- [ ] NÃ£o hÃ¡ combinaÃ§Ãµes absurdas?
- [ ] Bebidas apropriadas?
- [ ] Estrutura correta?

**5.3. Ajustar baseado em feedback**
- Refinar regras
- Adicionar mais validaÃ§Ãµes
- Melhorar prompt

---

## â±ï¸ TEMPO TOTAL ESTIMADO: 11-14 HORAS

**DistribuiÃ§Ã£o:**
- Fase 1 (Estrutura): 3-4h
- Fase 2 (ValidaÃ§Ã£o): 2-3h
- Fase 3 (Prompt): 2h
- Fase 4 (Alternativas): 2h
- Fase 5 (Testes): 2-3h

---

## ğŸ¯ RESULTADO ESPERADO

### âœ… **100% Culturalmente Correto**
- CafÃ© da manhÃ£ BR: PÃ£o + Ovo + CafÃ© âœ“
- AlmoÃ§o BR: Arroz + FeijÃ£o + Frango + Salada âœ“
- Breakfast US: Eggs + Toast + Orange juice âœ“
- AlmoÃ§o PT: Sopa + Bacalhau + Batatas âœ“

### âŒ **0% de CombinaÃ§Ãµes Absurdas**
- Sem arroz + cafÃ© âœ“
- Sem feijÃ£o + suco doce âœ“
- Sem macarrÃ£o + pÃ£o âœ“
- Sem combinaÃ§Ãµes culturalmente estranhas âœ“

### ğŸŒ **Autenticidade Cultural**
- Brasileiro reconhece como comida brasileira âœ“
- Americano reconhece como comida americana âœ“
- PortuguÃªs reconhece como comida portuguesa âœ“
- Mexicano reconhece como comida mexicana âœ“

---

## âš ï¸ AVISOS CRÃTICOS

1. **NÃƒO implementar tudo de uma vez** - Fazer incremental por fase
2. **TESTAR manualmente** cada paÃ­s e tipo antes de prosseguir
3. **VALIDAR com nativos** se possÃ­vel (ou pesquisar hÃ¡bitos reais)
4. **DOCUMENTAR** cada regra cultural com fonte/justificativa
5. **SER RIGOROSO** - Melhor rejeitar do que gerar errado

---

**Este Ã© o plano REVISADO com foco em RIGOR CULTURAL. Aguardando aprovaÃ§Ã£o para implementaÃ§Ã£o.**
