# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# GITHUB ACTIONS - SincronizaÃ§Ã£o AutomÃ¡tica de Ingredientes
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Dispara automaticamente quando meal-ingredients-db.ts Ã© modificado
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: ğŸ”„ Sync Ingredients to Database

on:
  push:
    branches:
      - main
      - master
      - develop
    paths:
      - 'supabase/functions/_shared/meal-ingredients-db.ts'
  
  # Permite execuÃ§Ã£o manual via GitHub UI
  workflow_dispatch:

jobs:
  sync-ingredients:
    name: Sincronizar Ingredientes
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4
      
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: ğŸ”§ Instalar dependÃªncias
        run: npm ci
      
      - name: ğŸ”„ Sincronizar ingredientes
        run: npm run sync:ingredients
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
      
      - name: âœ… Sucesso
        if: success()
        run: |
          echo "âœ… Ingredientes sincronizados com sucesso!"
          echo "ğŸ“Š Verifique o log acima para detalhes"
      
      - name: âŒ Falha
        if: failure()
        run: |
          echo "âŒ Erro ao sincronizar ingredientes"
          echo "ğŸ” Verifique os logs acima para mais informaÃ§Ãµes"
          exit 1

  # Job opcional: Notificar no Slack/Discord
  notify:
    name: Notificar Resultado
    runs-on: ubuntu-latest
    needs: sync-ingredients
    if: always()
    
    steps:
      - name: ğŸ“¢ Notificar sucesso
        if: needs.sync-ingredients.result == 'success'
        run: |
          echo "âœ… SincronizaÃ§Ã£o concluÃ­da com sucesso!"
          # Adicione aqui webhook do Slack/Discord se desejar
      
      - name: ğŸ“¢ Notificar falha
        if: needs.sync-ingredients.result == 'failure'
        run: |
          echo "âŒ SincronizaÃ§Ã£o falhou!"
          # Adicione aqui webhook do Slack/Discord se desejar
